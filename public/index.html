<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PancakeSwap LP Position Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-2xl font-bold mb-6">PancakeSwap LP Position Monitor</h1>
            
            <div class="flex gap-4 mb-6">
                <input 
                    type="text" 
                    id="addressInput"
                    placeholder="Enter wallet address" 
                    class="flex-1 p-2 border rounded"
                    value="0x46FB727c4B24A153FFf37EE97d29101f9952AFbf"
                >
                <button 
                    id="checkButton"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                >
                    Check Position
                </button>
            </div>

            <div id="errorMessage" class="hidden bg-red-100 text-red-700 p-4 rounded mb-4"></div>
            
            <div id="results" class="space-y-4"></div>
        </div>
    </div>

    <script>
        const addressInput = document.getElementById('addressInput');
        const checkButton = document.getElementById('checkButton');
        const errorMessage = document.getElementById('errorMessage');
        const results = document.getElementById('results');

        checkButton.addEventListener('click', async () => {
            const address = addressInput.value.trim();
            if (!address) return;

            // Reset UI
            errorMessage.classList.add('hidden');
            results.innerHTML = '';
            checkButton.classList.add('loading');
            checkButton.textContent = 'Checking...';

            try {
                const response = await fetch('/api/check-position', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ address }),
                });

                const data = await response.json();
                
                if (!response.ok) throw new Error(data.error);

                // Display results
                results.innerHTML = `
                    <div class="flex items-center gap-4 mb-4">
                        <img src="${data.protocol_logo}" alt="${data.protocol_name}" class="w-8 h-8">
                        <h3 class="text-xl font-semibold">${data.protocol_name}</h3>
                    </div>

                    <div class="bg-gray-100 p-4 rounded-lg mb-4">
                        <p class="text-lg font-medium">
                            Total Value: $${data.total_usd_value.toFixed(2)}
                        </p>
                    </div>

                    ${data.positions.map(position => `
                        <div class="border rounded-lg p-4 mb-4">
                            <h4 class="font-medium mb-2">Position Details:</h4>
                            <p>Share of Pool: ${position.position_details?.share_of_pool?.toFixed(2) || 0}%</p>
                            <p>Pair Address: ${position.address}</p>
                            
                            <div class="mt-4">
                                <h5 class="font-medium mb-2">Tokens:</h5>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    ${position.tokens
                                        .filter(token => token.token_type !== 'defi-token')
                                        .map(token => `
                                            <div class="bg-gray-50 p-4 rounded-lg">
                                                <div class="flex items-center gap-2 mb-2">
                                                    ${token.logo ? `<img src="${token.logo}" alt="${token.name}" class="w-6 h-6">` : ''}
                                                    <span class="font-medium">${token.name} (${token.symbol})</span>
                                                </div>
                                                <p>Balance: ${parseFloat(token.balance_formatted).toFixed(6)}</p>
                                                ${token.usd_value ? `<p>Value: $${token.usd_value.toFixed(2)}</p>` : ''}
                                            </div>
                                        `).join('')}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                `;

            } catch (error) {
                errorMessage.textContent = error.message;
                errorMessage.classList.remove('hidden');
            } finally {
                checkButton.classList.remove('loading');
                checkButton.textContent = 'Check Position';
            }
        });
    </script>
</body>
  </html>
